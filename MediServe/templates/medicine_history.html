{% extends 'base.html' %}
{% load static %}

{% block title %}Order History{% endblock %}

{% block content %}

    <div style="width: 100%; max-width: 900px; margin: 40px auto; background-color: #FFFFFF; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

        {# HEADER BAR #}
        <header style="padding: 15px 30px; border-bottom: 1px solid #ddd; display: flex; align-items: center;">
            <a href="{% url 'main_menu' %}" class="btn" style="
                padding: 8px 10px;
                margin-right: 15px;
                background-color: #f7f9fa;
                color: #36489e;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                justify-content: center;
                align-items: center;
                border: 1px solid #ddd;
                box-shadow: none;
            ">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 style="font-size: 1.5em; color: #36489e;">Order History</h1>
        </header>

        {# MAIN HISTORY CONTENT #}
        <main style="padding: 30px;">
            <p style="color: #555; margin-bottom: 20px;">A list of your completed and processed orders.</p>

            {# HISTORY TOOLS (Integrated into main view) #}
            <div class="history-tools" style="display: flex; gap: 15px; margin-bottom: 30px;">
                <button class="btn" style="background-color: #ddd; color: #333; cursor: not-allowed; padding: 10px 15px;">
                    <i class="fas fa-calendar-alt"></i> Filter by Date
                </button>
                <button class="btn" style="background-color: #ddd; color: #333; cursor: not-allowed; padding: 10px 15px;">
                    <i class="fas fa-search"></i> Search Orders
                </button>
            </div>

            <div class="history-list-view" style="width: 100%; display: flex; flex-direction: column; gap: 20px;">

                {% for order in past_orders %}
                    <div class="history-card" style="
                        background-color: #FFFFFF;
                        padding: 20px;
                        border-radius: 8px;
                        border: 1px solid #ddd;
                        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                    ">

                        {# ORDER SUMMARY HEADER #}
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee;">

                            <div style="flex-grow: 1;">
                                <strong style="font-size: 1.2em; color: #36489e;">Order #{{ order.id }}</strong>
                                <p style="font-size: 0.85em; color: #777; margin: 0;">Placed: {{ order.order_date|date:"M d, Y" }}</p>
                            </div>

                            <strong style="font-size: 1.4em; color: #dc3545;">
                                â‚±{{ order.total_price|floatformat:2 }}
                            </strong>
                        </div>

                        {# STATUS AND ACTION FOOTER #}
                        <div style="display: flex; justify-content: space-between; align-items: center;">

                            <span style="font-weight: bold; font-size: 1em; padding: 5px 10px; border-radius: 4px;
                                color: {% if order.status == 'Completed' %}#FFFFFF{% else %}#333{% endif %};
                                background-color: {% if order.status == 'Completed' %}#28a745{% else %}#ffc107{% endif %};
                            ">
                                {{ order.status }}
                            </span>

                            {# FIX APPLIED HERE: Changed 'order_details' to 'order_list' as a placeholder #}
                            <a href="{% url 'order_list' %}" class="btn" style="
                                background-color: #5c74e3;
                                color: #FFFFFF;
                                padding: 8px 15px;
                                font-size: 0.9em;
                            ">
                                <i class="fas fa-eye"></i> View Details
                            </a>
                        </div>

                    </div>
                {% empty %}
                    <p style="text-align: center; padding: 30px; border: 1px solid #ddd; border-radius: 8px;">
                        You have no completed orders yet.
                    </p>
                {% endfor %}

            </div>
        </main>
    </div>
{% endblock %}